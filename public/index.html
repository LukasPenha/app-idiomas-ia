<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkPro - App de Idiomas com IA</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="no-auth"> 
    <header id="app-header" class="hidden">
        <div class="screen-content header-content">
            <h1 class="logo-text desktop-nav">TalkPro</h1>
            <nav id="app-nav" class="desktop-nav">
                <button id="nav-home-btn" class="nav-btn">Início</button>
                <button id="nav-flashcards-btn" class="nav-btn">Flashcards</button>
                <button id="nav-history-btn" class="nav-btn">Meu Histórico</button>
            </nav>
            <div id="user-menu" class="user-menu desktop-nav"></div>
            <button id="mobile-menu-btn" class="mobile-nav-btn">
                <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </button>
        </div>
    </header>

    <div id="mobile-nav-overlay" class="mobile-nav-overlay">
        <nav id="mobile-nav-links"></nav>
        <div id="mobile-user-menu"></div>
    </div>

    <main id="app-main">

        <section id="login-screen" class="screen active">
            <div class="auth-box"> 
                <h1 class="auth-title">Bem-vindo(a)</h1>
                <p class="auth-subtitle">Escolha como quer continuar.</p>
                <div class="auth-actions-primary">
                    <button id="primary-google-btn" class="btn btn-google">Entrar com Google</button>
                    <button id="guest-login-btn" class="btn btn-outline btn-full">Continuar sem conta</button>
                </div>
                <div class="divider"><span>OU ENTRE COM SEU EMAIL</span></div>
                <form id="email-login-form" class="auth-form">
                    <p class="auth-message error" id="login-message"></p>
                    <div class="input-group"><label>Email</label><input type="email" id="login-email" required></div>
                    <div class="input-group"><label>Senha</label><input type="password" id="login-password" required></div>
                    <button type="submit" class="btn btn-primary btn-full">Entrar</button>
                </form>
                <div class="auth-links-footer">
                    <button id="go-to-register-link" class="link-btn">Criar conta</button>
                    <button id="go-to-forgot-password-link" class="link-btn">Esqueceu a senha?</button>
                </div>
            </div>
        </section>

        <section id="register-screen" class="screen">
            <div class="auth-box">
                <h1 class="auth-title">Criar Conta</h1>
                <form id="register-form" class="auth-form">
                    <p class="auth-message error" id="register-message"></p>
                    <div class="input-group"><label>Email</label><input type="email" id="register-email" required></div>
                    <div class="input-group"><label>Senha</label><input type="password" id="register-password" minlength="6" required></div>
                    <div class="input-group"><label>Confirmar Senha</label><input type="password" id="register-password-confirm" minlength="6" required></div>
                    <button type="submit" class="btn btn-primary btn-full">Criar Conta</button>
                </form>
                <div class="auth-links-footer"><button class="link-btn back-to-login-link">← Voltar</button></div>
            </div>
        </section>

        <section id="forgot-password-screen" class="screen">
            <div class="auth-box">
                <h1 class="auth-title">Recuperar Senha</h1>
                <form id="forgot-password-form" class="auth-form">
                    <p class="auth-message" id="forgot-password-message"></p>
                    <div class="input-group"><label>Email</label><input type="email" id="forgot-email" required></div>
                    <button type="submit" class="btn btn-primary btn-full">Enviar Link</button>
                </form>
                <div class="auth-links-footer"><button class="link-btn back-to-login-link">← Voltar</button></div>
            </div>
        </section>

        <section id="update-password-screen" class="screen">
            <div class="auth-box">
                <h1 class="auth-title">Nova Senha</h1>
                <form id="update-password-form" class="auth-form">
                    <p class="auth-message error" id="update-password-message"></p>
                    <div class="input-group"><label>Nova Senha</label><input type="password" id="update-password" minlength="6" required></div>
                    <div class="input-group"><label>Confirmar</label><input type="password" id="update-password-confirm" minlength="6" required></div>
                    <button type="submit" class="btn btn-primary btn-full">Salvar</button>
                </form>
            </div>
        </section>

        <section id="home-screen" class="screen">
            <div class="screen-content">
                <div class="language-selector">
                    <h2>Escolha um idioma:</h2>
                    <div class="language-options">
                        <div class="language-card" id="select-en" data-lang="en"><h3>Inglês</h3></div>
                        <div class="language-card" id="select-it" data-lang="it"><h3>Italiano</h3></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="topics-screen" class="screen">
            <div class="screen-content">
                <h2>Tópicos de Estudo</h2>
                <div class="level-tabs">
                    <button class="level-tab-btn active" data-level="iniciante">Iniciante</button>
                    <button class="level-tab-btn" data-level="intermediario">Intermediário</button>
                    <button class="level-tab-btn" data-level="avancado">Avançado</button>
                </div>
                <div class="controls-grid">
                    <input type="search" id="topic-search" placeholder="Buscar tópicos...">
                    <div class="custom-topic-box">
                        <input type="text" id="custom-topic-input" placeholder="Ou digite seu tópico...">
                        <button id="custom-topic-btn" class="btn btn-secondary">Gerar</button>
                    </div>
                </div>
                <div id="topic-list-container"></div>
            </div>
        </section>

        <section id="study-screen" class="screen">
            <div class="screen-content">
                <button id="back-to-topics-btn" class="btn btn-outline mb-4">← Voltar</button>
                <h2 id="study-topic-title">Carregando...</h2>
                <div id="study-content-wrapper" class="study-content"></div>
                <button id="start-quiz-config-btn" class="btn btn-primary btn-lg btn-sticky-footer">Pronto para o Quiz!</button>
            </div>
        </section>

        <section id="quiz-config-screen" class="screen">
            <div class="screen-content">
                <button id="back-to-study-btn" class="btn btn-outline mb-4">← Voltar</button>
                <div class="quiz-config-box">
                    <h2>Configurar Quiz</h2>
                    <div class="slider-container">
                        <input type="range" id="question-slider" min="5" max="30" value="5">
                        <span id="question-count">5 perguntas</span>
                    </div>
                    <button id="start-quiz-btn" class="btn btn-primary btn-lg btn-full">Começar</button>
                </div>
            </div>
        </section>

        <section id="quiz-screen" class="screen">
            <div class="screen-content">
                <div class="quiz-header">
                    <span id="quiz-progress">Pergunta 1/10</span>
                    <button id="quit-quiz-btn" class="btn btn-danger-outline">Sair</button>
                </div>
                <div class="quiz-question-card"><p id="question-text">Carregando...</p></div>
                <div id="options-container" class="quiz-options"></div>
                <button id="next-question-btn" class="btn btn-primary btn-lg btn-sticky-footer" disabled>Avançar</button>
            </div>
        </section>

        <section id="results-screen" class="screen">
            <div class="screen-content">
                <div class="results-summary">
                    <h2>Quiz Concluído!</h2>
                    <h3 id="score-text">Você acertou!</h3>
                    <div class="results-actions">
                        <button id="back-to-home-btn" class="btn btn-primary">Voltar aos Tópicos</button>
                        
                        <button id="review-answers-btn" class="btn btn-outline">Revisar</button>
                        <button id="back-to-history-btn" class="btn btn-outline hidden">Voltar ao Histórico</button>
                    </div>
                </div>
                <div id="answers-review-container"></div>
            </div>
        </section>

        <section id="history-screen" class="screen">
            <div class="screen-content">
                <h2>Histórico</h2>
                <div class="pdf-controls mb-4">
                    <button id="generate-review-pdf-btn" class="btn btn-primary" disabled>Gerar PDF</button>
                    <span id="pdf-helper-text" class="text-muted">Selecione para gerar PDF.</span>
                </div>
                <div id="history-list-container"></div>
            </div>
        </section>
        
        <section id="flashcards-screen" class="screen">
            <div class="screen-content">
                <h2>Meus Flashcards</h2>

                <div id="flashcards-main-tabs" class="level-tabs">
                    <button type="button" id="tab-decks-list" class="level-tab-btn active" data-view="deck-list-view">Meus Baralhos</button>
                    <button type="button" id="tab-deck-create" class="level-tab-btn" data-view="deck-create-view">Criar Novo</button>
                    <button type="button" id="tab-deck-stats" class="level-tab-btn" data-view="deck-stats-view">Estatísticas</button>
                </div>

                <div id="deck-list-view" class="flashcard-view active">
                    <div id="deck-list-container"></div>
                </div>

                <div id="deck-create-view" class="flashcard-view">
                    <form id="create-deck-form" class="auth-form" style="max-width: 600px; margin: 1rem auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                        <h3>Criar Novo Baralho</h3>
                        <p class="auth-message" id="create-deck-message"></p>
                        
                        <div class="input-group">
                            <label for="deck-name">Nome do Baralho</label>
                            <input type="text" id="deck-name" placeholder="Ex: Verbos (Inglês)" required>
                        </div>

                        <div class="level-tabs small-tabs">
                            <button type="button" id="tab-btn-manual" class="level-tab-btn active" data-target="create-manual-content">Manual</button>
                            <button type="button" id="tab-btn-ai" class="level-tab-btn" data-target="create-ai-content">Gerar com IA</button>
                        </div>

                        <div id="create-manual-content" class="create-content active">
                            <p class="auth-subtitle">Adicione cartões.</p>
                            <div id="manual-cards-container"></div>
                            <button type="button" id="add-manual-card-field" class="btn btn-outline btn-small" style="margin-top: 1rem;">+ Cartão</button>
                        </div>

                        <div id="create-ai-content" class="create-content">
                            <p class="auth-subtitle">Ex: "10 frutas em italiano"</p>
                            <div class="input-group">
                                <label>Tópico</label>
                                <input type="text" id="ai-deck-topic">
                            </div>
                            <button type="button" id="generate-ai-cards-btn" class="btn btn-secondary btn-full">Gerar Cartões</button>
                            <div id="ai-cards-selection-list"></div>
                        </div>

                        <hr class="divider-line">
                        <button type="submit" class="btn btn-primary btn-lg btn-full">Salvar Baralho</button>
                    </form>
                </div>

                <div id="deck-stats-view" class="flashcard-view">
                    <div class="stats-container">
                        <h3>Revisões da Semana</h3>
                        <div class="chart-container"><canvas id="review-chart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="deck-manage-screen" class="screen">
            <div class="screen-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                    <button id="manage-back-btn" class="btn btn-outline">← Voltar</button>
                    <h2 id="manage-deck-title">Gerenciar Baralho</h2>
                </div>

                <div class="add-single-card-box" style="background: #fff; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4>Adicionar Novo Cartão</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 0.5rem; align-items: end;">
                        <input type="text" id="new-card-front" placeholder="Frente">
                        <input type="text" id="new-card-back" placeholder="Verso">
                        <button id="btn-add-single-card" class="btn btn-success btn-small" style="height: 42px;">Adicionar</button>
                    </div>
                </div>

                <div id="manage-cards-list" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
            </div>
        </section>

        <section id="review-session-screen" class="screen">
            <div class="screen-content">
                <button id="review-back-btn" class="btn btn-outline mb-4">← Sair</button>
                
                <div id="review-card-container">
                    <div class="review-card-box">
                        <div id="review-card-front" class="review-card-face"></div>
                        <div id="review-card-back" class="review-card-face hidden"></div>
                    </div>
                </div>

                <div id="review-empty-state" class="hidden">
                    <h2>Parabéns!</h2>
                    <p>Você revisou tudo por hoje.</p>
                    <button id="review-again-btn" class="btn btn-primary-outline" style="margin-top: 1rem;">Revisar Novamente Agora</button>
                </div>
                
                <button id="review-show-answer-btn" class="btn btn-primary btn-lg btn-full">Mostrar Resposta</button>
                
                <div id="review-rating-container" class="review-rating-buttons hidden">
                    <button class="btn btn-danger" data-rating="again">Errei</button>
                    <button class="btn btn-outline" data-rating="ok">OK</button>
                    <button class="btn btn-success" data-rating="easy">Fácil</button>
                </div>
            </div>
        </section>

    </main>

    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p id="loading-text">Carregando...</p>
    </div>

    <script src="script.js"></script>
</body>
</html>